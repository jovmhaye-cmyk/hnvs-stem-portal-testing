<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HNVS STEM Learning Portal</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1; 
        }
        ::-webkit-scrollbar-thumb {
            background: #ccc; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #660000; 
        }
        .animate-in {
            animation: fadeIn 0.3s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 font-sans">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- ICON COMPONENTS (Mocked for single file usage) ---
        // These replace the 'lucide-react' imports
        const Icon = ({ d, size = 24, className = "", fill = "none", stroke = "currentColor" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill={fill} stroke={stroke} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d={d} />
            </svg>
        );

        const Bell = (props) => <Icon d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9 M10.3 21a1.94 1.94 0 0 0 3.4 0" {...props} />;
        const Menu = (props) => <Icon d="M4 12h16 M4 6h16 M4 18h16" {...props} />;
        const Search = (props) => <Icon d="m21 21-4.3-4.3 M11 19a8 8 0 1 0 0-16 8 8 0 0 0 0 16" {...props} />;
        const BookOpen = (props) => <Icon d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z" {...props} />;
        const Beaker = (props) => <Icon d="M4.5 3h15 M6 3v16a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V3 M6 14h12" {...props} />; // Flask/Beaker
        const Atom = (props) => <Icon d="M12 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0-2 0 M20.2 20.2c2.04-2.03.02-7.36-4.5-11.9-4.54-4.52-9.87-6.54-11.9-4.5-2.04 2.03-.02 7.36 4.5 11.9 4.54 4.52 9.87 6.54 11.9 4.5z M15.7 15.7c4.52-4.54 6.54-9.87 4.5-11.9-2.03-2.04-7.36-.02-11.9 4.5-4.52 4.54-6.54 9.87-4.5 11.9 2.03 2.04 7.36.02 11.9-4.5z" {...props} />;
        const AlertTriangle = (props) => <Icon d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z M12 9v4 M12 17h.01" {...props} />;
        const Trophy = (props) => <Icon d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6 M18 9h1.5a2.5 2.5 0 0 0 0-5H18 M4 22h16 M8 22v-8a4 4 0 0 1 8 0v8" {...props} />;
        const Calendar = (props) => <Icon d="M8 2v4 M16 2v4 M3 10h18 M5 4h14a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2z" {...props} />;
        const Wifi = (props) => <Icon d="M5 12.55a11 11 0 0 1 14.08 0 M1.42 9a16 16 0 0 1 21.16 0 M8.53 16.11a6 6 0 0 1 6.95 0 M12 20h.01" {...props} />;
        const WifiOff = (props) => <Icon d="M1 1l22 22 M16.72 11.06A10.94 10.94 0 0 1 19 12.55 M5 12.55a10.94 10.94 0 0 1 5.17-2.39 M10.71 5.05A16 16 0 0 1 22.58 9 M1.42 9a15.91 15.91 0 0 1 4.7-2.88 M8.53 16.11a6 6 0 0 1 6.95 0 M12 20h.01" {...props} />;
        const Settings = (props) => <Icon d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.1a2 2 0 0 1-1-1.72v-.51a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6z" {...props} />;
        const User = (props) => <Icon d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2 M12 11a4 4 0 1 0 0-8 4 4 0 0 0 0 8z" {...props} />;
        const LogOut = (props) => <Icon d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4 M16 17l5-5-5-5 M21 12H9" {...props} />;
        const FileText = (props) => <Icon d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z M14 2v6h6 M16 13H8 M16 17H8 M10 9H8" {...props} />;
        const CheckCircle = (props) => <Icon d="M22 11.08V12a10 10 0 1 1-5.93-9.14 M22 4L12 14.01l-3-3" {...props} />;
        const Download = (props) => <Icon d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4 M7 10l5 5 5-5 M12 15V3" {...props} />;
        const ChevronRight = (props) => <Icon d="M9 18l6-6-6-6" {...props} />;
        const MoreVertical = (props) => <Icon d="M12 12h.01 M12 5h.01 M12 19h.01" {...props} />;
        const Users = (props) => <Icon d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2 M16 3.13a4 4 0 0 1 0 7.75 M23 21v-2a4 4 0 0 0-3-3.87" {...props} />;
        const Shield = (props) => <Icon d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" {...props} />;
        const FileCheck = (props) => <Icon d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z M14 2v6h6 M9 15l2 2 4-4" {...props} />;
        const HelpCircle = (props) => <Icon d="M12 22a10 10 0 1 1 0-20 10 10 0 0 1 0 20z M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3 M12 17h.01" {...props} />;
        const Smartphone = (props) => <Icon d="M5 17h14 M5 12h14 M5 7h14" {...props} />; // Simplified
        const Clock = (props) => <Icon d="M12 22a10 10 0 1 1 0-20 10 10 0 0 1 0 20z M12 6v6l4 2" {...props} />;
        const PlusCircle = (props) => <Icon d="M12 22a10 10 0 1 1 0-20 10 10 0 0 1 0 20z M12 8v8 M8 12h8" {...props} />;
        const Save = (props) => <Icon d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z M17 21v-8H7v8 M7 3v5h8" {...props} />;
        const Upload = (props) => <Icon d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4 M17 8l-5-5-5 5 M12 3v12" {...props} />;
        const Trash2 = (props) => <Icon d="M3 6h18 M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" {...props} />;
        const Edit = (props) => <Icon d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7 M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" {...props} />;
        const Check = (props) => <Icon d="M20 6L9 17l-5-5" {...props} />;
        const X = (props) => <Icon d="M18 6L6 18 M6 6l12 12" {...props} />;
        const Briefcase = (props) => <Icon d="M20 7h-2.5a2.5 2.5 0 0 0-5 0H4a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2z M9 7V5a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v2" {...props} />;
        const PlayCircle = (props) => <Icon d="M12 22a10 10 0 1 1 0-20 10 10 0 0 1 0 20z M10 8l6 4-6 4V8z" {...props} />;
        const Pause = (props) => <Icon d="M6 4h4v16H6z M14 4h4v16h-4z" {...props} />;
        const Volume2 = (props) => <Icon d="M11 5L6 9H2v6h4l5 4V5z M19.07 4.93a10 10 0 0 1 0 14.14 M15.54 8.46a5 5 0 0 1 0 7.07" {...props} />;
        const Maximize = (props) => <Icon d="M8 3H5a2 2 0 0 0-2 2v3 M16 3h3a2 2 0 0 1 2 2v3 M8 21H5a2 2 0 0 1-2-2v-3 M16 21h3a2 2 0 0 0 2-2v-3" {...props} />;
        const Award = (props) => <Icon d="M12 15l-2 5l2-1l2 1l-2-5 M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2v-2.26C4.19 13.47 3 11.38 3 9a7 7 0 0 1 9-7z" {...props} />;
        const Loader2 = (props) => <Icon className={`animate-spin ${props.className}`} d="M21 12a9 9 0 1 1-6.219-8.56" {...props} />;
        const Sparkles = (props) => <Icon d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" {...props} />;
        const Bot = (props) => <Icon d="M12 2a2 2 0 0 1 2 2v2a2 2 0 0 1-2 2a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2z M19 11v-1a2 2 0 0 0-2-2H7a2 2 0 0 0-2 2v1a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2z M12 22v-4 M8 22v-4 M16 22v-4 M4 14a2 2 0 0 1 2-2M20 12a2 2 0 0 1 2 2" {...props} />;
        const Send = (props) => <Icon d="M22 2L11 13 M22 2l-7 20-4-9-9-4 20-7z" {...props} />;
        const Megaphone = (props) => <Icon d="M3 11l18-5v12L3 13v-2z M11.6 16.8a3 3 0 1 1-5.8-1.6" {...props} />;
        const Timer = (props) => <Icon d="M10 2h4 M12 14l3-3 M12 22a10 10 0 1 1 0-20 10 10 0 0 1 0 20z" {...props} />;

        const HNVS_COLORS = {
            maroon: "bg-[#660000]",
            maroonDark: "bg-[#4a0000]",
            maroonText: "text-[#660000]",
            yellow: "bg-[#FFD700]",
            yellowText: "text-[#FFD700]",
            yellowBorder: "border-[#FFD700]",
            bgLight: "bg-gray-50"
        };

        // --- MOCK DATA FOR ALL SUBJECTS ---
        const COURSES_DATA = {
            chem2: {
                id: 'chem2',
                title: "Gen. Chem 2",
                instructor: "Ms. Jennysel O. Lozada",
                icon: Beaker,
                progress: 75,
                nextTask: "Stoichiometry Quiz due Tomorrow",
                modules: [
                {
                    id: 1,
                    week: "Week 1: Intermolecular Forces",
                    status: "Completed",
                    statusColor: "bg-gray-100 text-gray-600",
                    lecture: { title: "Dipole-Dipole Interactions", size: "1.5 MB" },
                    video: { title: "Liquids and Solids", duration: "12 mins" },
                    assignment: { title: "Lab Report: Viscosity", due: "Oct 10", points: "20" },
                    quiz: { title: "Quiz 1: Forces", due: "Oct 12" }
                },
                {
                    id: 2,
                    week: "Week 2: Physical Properties of Solutions",
                    status: "Active",
                    statusColor: "bg-green-100 text-green-600",
                    lecture: { title: "Concentration Units", size: "2.1 MB" },
                    video: { title: "Molarity vs Molality", duration: "15 mins" },
                    assignment: { title: "Problem Set: Solutions", due: "Nov 25", points: "30" },
                    quiz: { title: "Quiz 2: Solution Chemistry", due: "Nov 27" }
                }
                ],
                quizQuestions: [
                { id: 1, text: "Which interaction is the strongest?", options: ["London Dispersion", "Dipole-Dipole", "Hydrogen Bonding", "Ion-Dipole"], correctIndex: 3 },
                { id: 2, text: "What is the unit of Molarity?", options: ["mol/kg", "mol/L", "g/L", "mol/g"], correctIndex: 1 },
                { id: 3, text: "Which factor affects solubility of gas in liquid?", options: ["Pressure", "Volume", "Catalyst", "Surface Area"], correctIndex: 0 }
                ]
            },
            physics2: {
                id: 'physics2',
                title: "Gen Physics",
                instructor: "Mr. Allen I. Dalinog",
                icon: Atom,
                progress: 60,
                nextTask: "New Module: Thermodynamics",
                modules: [
                {
                    id: 4,
                    week: "Week 4: Thermodynamics",
                    status: "Completed",
                    statusColor: "bg-gray-100 text-gray-600",
                    lecture: { title: "Laws of Thermodynamics", size: "3.1 MB" },
                    video: { title: "Heat Transfer Mechanisms", duration: "20 mins" },
                    assignment: { title: "Problem Set 4: Entropy", due: "Nov 08", points: "20" },
                    quiz: { title: "Quiz 4: Thermodynamics", due: "Nov 10" }
                },
                {
                    id: 5,
                    week: "Week 5: Electromagnetism",
                    status: "Active",
                    statusColor: "bg-green-100 text-green-600",
                    lecture: { title: "Intro to EM Fields", size: "2.4 MB" },
                    video: { title: "Maxwell's Equations", duration: "15 mins" },
                    assignment: { title: "Assignment: Problem Set 5", due: "Nov 15", points: "20" },
                    quiz: { title: "Quiz 5: Electromagnetism Basics", due: "Nov 17" }
                }
                ],
                quizQuestions: [
                    { id: 1, text: "What is the SI unit of electric capacitance?", options: ["Henry", "Farad", "Ohm", "Tesla"], correctIndex: 1 },
                    { id: 2, text: "Which law relates voltage, current, and resistance?", options: ["Newton's Law", "Ohm's Law", "Coulomb's Law", "Faraday's Law"], correctIndex: 1 },
                    { id: 3, text: "Electromagnetic waves travel at the speed of...", options: ["Sound", "Light", "Electron", "Proton"], correctIndex: 1 }
                ]
            },
            drr: {
                id: 'drr',
                title: "DRR",
                instructor: "Mr. Isaac Moses L. Gabison",
                icon: Shield,
                progress: 90,
                nextTask: "All tasks up to date.",
                modules: [
                {
                    id: 1,
                    week: "Week 1: Basic Concepts",
                    status: "Completed",
                    statusColor: "bg-gray-100 text-gray-600",
                    lecture: { title: "Hazard vs Risk", size: "1.2 MB" },
                    video: { title: "Understanding Vulnerability", duration: "10 mins" },
                    assignment: { title: "Essay: Local Hazards", due: "Oct 5", points: "50" },
                    quiz: { title: "Quiz 1: DRR Concepts", due: "Oct 7" }
                }
                ],
                quizQuestions: [
                    { id: 1, text: "What does DRR stand for?", options: ["Disaster Risk Reduction", "Daily Risk Report", "Danger Response Rescue", "Direct Relief Region"], correctIndex: 0 },
                    { id: 2, text: "Which is a geological hazard?", options: ["Typhoon", "Earthquake", "Flood", "Drought"], correctIndex: 1 },
                    { id: 3, text: "What is the first step in disaster management?", options: ["Response", "Recovery", "Mitigation", "Preparation"], correctIndex: 2 }
                ]
            },
            mil: {
                id: 'mil',
                title: "MIL",
                instructor: "Mr. Emmanuel R. Barrientos",
                icon: FileText,
                progress: 45,
                nextTask: "Assignment: Media Analysis Pending",
                modules: [
                {
                    id: 1,
                    week: "Week 3: Types of Media",
                    status: "Active",
                    statusColor: "bg-green-100 text-green-600",
                    lecture: { title: "Print vs Broadcast vs New Media", size: "4.5 MB" },
                    video: { title: "Evolution of Media", duration: "25 mins" },
                    assignment: { title: "Media Log Activity", due: "Nov 30", points: "40" },
                    quiz: { title: "Quiz 3: Media Convergence", due: "Dec 2" }
                }
                ],
                quizQuestions: [
                    { id: 1, text: "Which is an example of New Media?", options: ["Newspaper", "Radio", "Social Media", "Television"], correctIndex: 2 },
                    { id: 2, text: "What is Media Literacy?", options: ["Reading books", "Analyzing media content", "Making movies", "Selling ads"], correctIndex: 1 },
                    { id: 3, text: "Who coined 'The medium is the message'?", options: ["Marshall McLuhan", "Bill Gates", "Mark Zuckerberg", "Steve Jobs"], correctIndex: 0 }
                ]
            },
            capstone: {
                id: 'capstone',
                title: "Capstone",
                instructor: "Mr. Marjun P. Goron",
                icon: Sparkles,
                progress: 20,
                nextTask: "Project: Proposal Defense Prep",
                modules: [
                {
                    id: 1,
                    week: "Phase 1: Proposal",
                    status: "Active",
                    statusColor: "bg-blue-50 text-blue-600",
                    lecture: { title: "Writing Chapter 1", size: "1.0 MB" },
                    video: { title: "Defense Tips", duration: "45 mins" },
                    assignment: { title: "Submission: Chapter 1-3", due: "Dec 15", points: "100" },
                    quiz: { title: "Quiz: Research Ethics", due: "Dec 10" }
                }
                ],
                quizQuestions: [
                    { id: 1, text: "Which part of research explains the 'Why'?", options: ["Methodology", "Introduction", "Results", "Conclusion"], correctIndex: 1 },
                    { id: 2, text: "What is a variable?", options: ["A constant", "Something that changes", "A conclusion", "A title"], correctIndex: 1 },
                    { id: 3, text: "Which is quantitative research?", options: ["Interviews", "Surveys with stats", "Observations", "Biographies"], correctIndex: 1 }
                ]
            },
            iii: {
                id: 'iii',
                title: "III",
                instructor: "Ms. Liamie A. Dalmacio",
                icon: Search,
                progress: 85,
                nextTask: "Research Methodology Approved",
                modules: [
                {
                    id: 1,
                    week: "Unit 4: Data Collection",
                    status: "Active",
                    statusColor: "bg-green-100 text-green-600",
                    lecture: { title: "Inquiries and Investigation", size: "2.2 MB" },
                    video: { title: "Conducting Interviews", duration: "14 mins" },
                    assignment: { title: "Field Notes Submission", due: "Nov 28", points: "50" },
                    quiz: { title: "Quiz: Qualitative Methods", due: "Nov 29" }
                }
                ],
                quizQuestions: [
                    { id: 1, text: "III stands for?", options: ["Inquiries, Investigations, Immersion", "Internet, Information, Innovation", "Ice, Iguana, Igloo", "None"], correctIndex: 0 },
                    { id: 2, text: "Immersion involves?", options: ["Sleeping", "Reading only", "Experiencing the environment", "Writing only"], correctIndex: 2 },
                    { id: 3, text: "Brainstorming is for?", options: ["Generating ideas", "Criticizing ideas", "Ignoring ideas", "Finalizing ideas"], correctIndex: 0 }
                ]
            }
        };

        // --- API ---
        const apiKey = ""; 
        const callGemini = async (prompt, systemInstruction = "") => {
            // Mock AI response for offline HTML file
            return new Promise(resolve => {
                setTimeout(() => {
                    resolve("This is a simulated AI response because we are in a static HTML file. In a real app, this would call the Gemini API.");
                }, 1000);
            });
        };

        const SHOW_DEMO_CONTROLS = true; 

        // --- COMPONENTS ---
        
        const GeminiChatWidget = () => {
            const [isOpen, setIsOpen] = useState(false);
            const [messages, setMessages] = useState([
                { role: 'ai', text: "Hello! I'm your HNVS AI Tutor. How can I help you with your STEM studies today?" }
            ]);
            const [input, setInput] = useState("");
            const [loading, setLoading] = useState(false);
            const messagesEndRef = useRef(null);

            const scrollToBottom = () => {
                messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
            };

            useEffect(scrollToBottom, [messages]);

            const handleSend = async () => {
                if (!input.trim()) return;
                
                const userMsg = { role: 'user', text: input };
                setMessages(prev => [...prev, userMsg]);
                setInput("");
                setLoading(true);

                const response = await callGemini(input, "Be concise, encouraging, and academic.");

                setMessages(prev => [...prev, { role: 'ai', text: response }]);
                setLoading(false);
            };

            if (!isOpen) {
                return (
                    <button onClick={() => setIsOpen(true)} className="fixed bottom-6 right-6 bg-gradient-to-r from-indigo-600 to-purple-600 text-white p-4 rounded-full shadow-2xl hover:scale-105 transition-transform z-50 flex items-center gap-2">
                        <HelpCircle size={24} className="animate-pulse" />
                        <span className="font-bold hidden md:inline">AI Tutor</span>
                    </button>
                );
            }

            return (
                <div className="fixed bottom-6 right-6 w-80 md:w-96 bg-white rounded-2xl shadow-2xl border border-gray-200 z-50 flex flex-col overflow-hidden animate-in h-[500px]">
                    <div className="p-4 bg-gradient-to-r from-indigo-600 to-purple-600 text-white flex justify-between items-center">
                        <div className="flex items-center gap-2 font-bold">
                            <User size={20} className="text-[#FFD700]" /> Gemini AI Tutor
                        </div>
                        <button onClick={() => setIsOpen(false)} className="hover:bg-white/20 p-1 rounded"><X size={18} /></button>
                    </div>
                    <div className="flex-1 p-4 overflow-y-auto bg-gray-50 space-y-4">
                        {messages.map((msg, idx) => (
                            <div key={idx} className={`flex gap-2 ${msg.role === 'user' ? 'flex-row-reverse' : ''}`}>
                                <div className={`w-8 h-8 rounded-full flex items-center justify-center shrink-0 ${msg.role === 'ai' ? 'bg-indigo-100 text-indigo-600' : 'bg-gray-200 text-gray-600'}`}>
                                    {msg.role === 'ai' ? <Bot size={16} /> : <User size={16} />}
                                </div>
                                <div className={`p-3 rounded-xl text-sm shadow-sm max-w-[80%] ${msg.role === 'ai' ? 'bg-white border border-gray-100 text-gray-800 rounded-tl-none' : 'bg-indigo-600 text-white rounded-tr-none'}`}>
                                    {msg.text}
                                </div>
                            </div>
                        ))}
                        {loading && <div className="text-gray-500 text-xs text-center">Thinking...</div>}
                        <div ref={messagesEndRef} />
                    </div>
                    <div className="p-3 border-t border-gray-200 bg-white flex gap-2">
                        <input type="text" value={input} onChange={(e) => setInput(e.target.value)} onKeyDown={(e) => e.key === 'Enter' && handleSend()} placeholder="Ask anything..." className="flex-1 pl-4 pr-4 py-2 border border-gray-300 rounded-full text-sm focus:ring-2 focus:ring-indigo-500 focus:outline-none" />
                        <button onClick={handleSend} disabled={loading} className="p-2 bg-indigo-600 rounded-full text-white hover:bg-indigo-700 disabled:opacity-50"><ChevronRight size={16} /></button>
                    </div>
                </div>
            );
        };

        const Header = ({ onProfileClick }) => (
            <header className={`${HNVS_COLORS.maroon} text-white shadow-lg h-16 flex items-center justify-between px-6`}>
                <div className="flex items-center gap-3 font-bold text-lg"><span className="bg-white text-[#660000] rounded-full w-8 h-8 flex items-center justify-center">H</span> HNVS STEM</div>
                <div className="flex items-center gap-4">
                    <Bell size={20} />
                    <div onClick={onProfileClick} className="w-8 h-8 bg-[#FFD700] rounded-full flex items-center justify-center text-black font-bold text-xs cursor-pointer hover:ring-2 hover:ring-white transition-all" title="View Profile">JS</div>
                </div>
            </header>
        );

        const LoginView = ({ onLogin }) => {
             const [role, setRole] = useState('student');
             return (
                 <div className="flex flex-1 flex-col md:flex-row h-screen">
                    <div className={`md:w-1/2 ${HNVS_COLORS.maroon} relative flex items-center justify-center text-white p-10 flex-col`}>
                         <div className="w-24 h-24 bg-white rounded-full flex items-center justify-center mb-6 overflow-hidden border-4 border-[#FFD700]"><img src="https://via.placeholder.com/150?text=HNVS" alt="Logo" className="w-full h-full object-cover"/></div>
                         <h1 className="text-4xl font-bold text-center mb-2">Hilongos National<br/>Vocational School</h1>
                         <p className={`text-xl ${HNVS_COLORS.yellowText} tracking-widest uppercase`}>STEM Learning Portal</p>
                    </div>
                    <div className="md:w-1/2 bg-white flex items-center justify-center p-8">
                        <div className="w-full max-w-md space-y-8">
                            <h2 className={`text-3xl font-bold ${HNVS_COLORS.maroonText}`}>Welcome Back</h2>
                            <div className="flex space-x-1 bg-gray-100 p-1 rounded-lg">
                                {['student', 'teacher', 'admin'].map(r => (
                                    <button key={r} onClick={() => setRole(r)} className={`flex-1 py-2 text-sm font-bold rounded capitalize ${role === r ? 'bg-white shadow text-[#660000]' : 'text-gray-500'}`}>{r}</button>
                                ))}
                            </div>
                            <form className="space-y-6" onSubmit={(e) => { e.preventDefault(); onLogin(role); }}>
                                <input type="text" placeholder="ID / Email" className="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-[#660000]" />
                                <input type="password" placeholder="Password" className="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-[#660000]" />
                                <button type="submit" className={`w-full py-3 text-white font-bold rounded-lg ${HNVS_COLORS.maroon} hover:opacity-90`}>Sign In as {role.charAt(0).toUpperCase() + role.slice(1)}</button>
                            </form>
                        </div>
                    </div>
                 </div>
             );
        };

        const PersonalAccountView = ({ onBack, onLogout }) => {
            return (
                <div className="flex-1 flex flex-col bg-gray-50 min-h-screen">
                    <header className={`${HNVS_COLORS.maroon} text-white shadow-lg h-16 flex items-center justify-between px-6`}>
                        <div className="flex items-center gap-3 font-bold text-lg">
                            <button onClick={onBack} className="hover:bg-white/20 p-1 rounded"><ChevronRight className="rotate-180" size={24} /></button>
                            My Profile
                        </div>
                    </header>
                    <main className="max-w-3xl mx-auto w-full p-8">
                        <div className="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                            <div className="h-32 bg-gradient-to-r from-[#660000] to-[#990000]"></div>
                            <div className="px-8 pb-8">
                                <div className="relative flex justify-between items-end -mt-12 mb-6">
                                    <div className="w-24 h-24 bg-[#FFD700] rounded-full border-4 border-white flex items-center justify-center text-3xl font-bold text-[#660000] shadow-lg">JS</div>
                                    <button className="bg-gray-100 text-gray-700 px-4 py-2 rounded-lg text-sm font-bold hover:bg-gray-200 flex items-center gap-2"><Edit size={16} /> Edit Profile</button>
                                </div>
                                <div className="space-y-6">
                                    <div><h1 className="text-2xl font-bold text-gray-900">Juan Student</h1><p className="text-gray-500">Grade 12 - STEM A</p></div>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        <div className="p-4 bg-gray-50 rounded-lg border border-gray-100"><label className="text-xs font-bold text-gray-500 uppercase">Student ID</label><p className="text-gray-900 font-medium">2023-10455</p></div>
                                        <div className="p-4 bg-gray-50 rounded-lg border border-gray-100"><label className="text-xs font-bold text-gray-500 uppercase">Email Address</label><p className="text-gray-900 font-medium">juan.student@hnvs.edu.ph</p></div>
                                        <div className="p-4 bg-gray-50 rounded-lg border border-gray-100"><label className="text-xs font-bold text-gray-500 uppercase">Contact Number</label><p className="text-gray-900 font-medium">+63 917 123 4567</p></div>
                                        <div className="p-4 bg-gray-50 rounded-lg border border-gray-100"><label className="text-xs font-bold text-gray-500 uppercase">Enrollment Status</label><span className="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">Enrolled</span></div>
                                    </div>
                                    <div className="border-t border-gray-100 pt-6">
                                        <h3 className="font-bold text-gray-900 mb-4">Account Settings</h3>
                                        <div className="space-y-3">
                                            <button className="w-full flex items-center justify-between p-3 hover:bg-gray-50 rounded-lg transition"><span className="flex items-center gap-3 text-gray-700"><Bell size={18} /> Notification Preferences</span><ChevronRight size={16} className="text-gray-400" /></button>
                                            <button className="w-full flex items-center justify-between p-3 hover:bg-gray-50 rounded-lg transition"><span className="flex items-center gap-3 text-gray-700"><Shield size={18} /> Privacy & Security</span><ChevronRight size={16} className="text-gray-400" /></button>
                                            <button onClick={onLogout} className="w-full flex items-center justify-between p-3 hover:bg-red-50 rounded-lg transition text-red-600 mt-4"><span className="flex items-center gap-3 font-bold"><LogOut size={18} /> Sign Out</span></button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </main>
                </div>
            );
        };

        const StudentDashboard = ({ onViewCourse, onTakeQuiz, onProfileClick }) => {
            return (
                <div className="flex-1 flex flex-col bg-gray-50 min-h-screen">
                    <Header onProfileClick={onProfileClick} />
                    <main className="max-w-7xl mx-auto w-full p-6">
                        <h2 className="text-2xl font-bold text-[#660000] mb-6 flex items-center gap-2"><BookOpen size={24} /> My STEM Courses</h2>
                        <div className="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
                            {Object.values(COURSES_DATA).map(course => (
                                <div key={course.id} className="bg-white rounded-xl shadow border p-6 flex flex-col gap-4 hover:shadow-md transition">
                                    <div className="flex justify-between items-start">
                                        <div className={`p-3 rounded-lg ${HNVS_COLORS.maroon} text-white`}><course.icon size={24} /></div>
                                        <span className="bg-yellow-100 text-yellow-800 text-xs font-bold px-2 py-1 rounded">Active</span>
                                    </div>
                                    <div><h3 className="text-xl font-bold text-gray-900">{course.title}</h3><p className="text-sm text-gray-500">{course.instructor}</p></div>
                                    <div className="flex gap-2 mt-auto">
                                        <button onClick={() => onViewCourse(course.id)} className="flex-1 py-2 text-sm font-bold text-[#660000] hover:bg-red-50 rounded border border-transparent hover:border-red-100">View Materials</button>
                                        <button onClick={() => onTakeQuiz(course.id)} className="px-4 py-2 bg-[#FFD700] text-black text-sm font-bold rounded hover:bg-yellow-400">Take Quiz</button>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </main>
                </div>
            );
        };

        const CourseView = ({ courseId, onTakeQuiz, onProfileClick }) => {
            const course = COURSES_DATA[courseId] || COURSES_DATA.physics2;
            const [viewingLesson, setViewingLesson] = useState(null);
            const [viewingVideo, setViewingVideo] = useState(null);
            const [uploading, setUploading] = useState(null);

            return (
                <div className="flex-1 flex flex-col bg-gray-50 min-h-screen">
                    <Header onProfileClick={onProfileClick} />
                    <div className="bg-white border-b px-6 py-4 shadow-sm flex justify-between items-center">
                        <h1 className="text-xl font-bold text-gray-900">{course.title}</h1>
                        <div className="text-sm text-gray-500">SY 2025-2026</div>
                    </div>
                    <main className="max-w-5xl mx-auto w-full p-6 space-y-6">
                        {course.modules.map(mod => (
                            <div key={mod.id} className="bg-white rounded-lg border shadow-sm overflow-hidden">
                                <div className="bg-gray-50 px-6 py-3 border-b font-bold text-gray-800 flex justify-between">{mod.week} <span className="text-xs bg-green-100 text-green-700 px-2 py-1 rounded">Active</span></div>
                                <div className="divide-y">
                                    <div className="p-4 flex justify-between items-center hover:bg-gray-50 cursor-pointer" onClick={() => setViewingLesson(mod.lecture)}>
                                        <div className="flex items-center gap-3"><div className="bg-red-100 text-red-600 p-2 rounded"><FileText size={18} /></div><div><p className="font-bold text-sm">{mod.lecture.title}</p><p className="text-xs text-gray-500">PDF</p></div></div>
                                        <Download size={18} className="text-gray-400" />
                                    </div>
                                    <div className="p-4 flex justify-between items-center hover:bg-gray-50 cursor-pointer" onClick={() => setViewingVideo(mod.video)}>
                                        <div className="flex items-center gap-3"><div className="bg-blue-100 text-blue-600 p-2 rounded"><PlayCircle size={18} /></div><div><p className="font-bold text-sm">{mod.video.title}</p><p className="text-xs text-gray-500">Video</p></div></div>
                                        <Download size={18} className="text-gray-400" />
                                    </div>
                                    <div className="p-4 flex justify-between items-center hover:bg-gray-50 bg-purple-50/30">
                                        <div className="flex items-center gap-3"><div className="bg-purple-100 text-purple-600 p-2 rounded"><CheckCircle size={18} /></div><div><p className="font-bold text-sm">{mod.assignment.title}</p><p className="text-xs text-gray-500">Due: {mod.assignment.due}</p></div></div>
                                        <button onClick={() => setUploading(mod.assignment)} className="text-xs font-bold bg-purple-600 text-white px-3 py-1.5 rounded hover:bg-purple-700">Upload</button>
                                    </div>
                                    <div className="p-4 flex justify-between items-center hover:bg-gray-50 bg-yellow-50/30">
                                        <div className="flex items-center gap-3"><div className="bg-[#660000] text-white p-2 rounded"><Award size={18} /></div><div><p className="font-bold text-sm">{mod.quiz.title}</p><p className="text-xs text-gray-500">Due: {mod.quiz.due}</p></div></div>
                                        <button onClick={() => onTakeQuiz(course.id)} className="text-xs font-bold bg-[#FFD700] text-black px-3 py-1.5 rounded hover:bg-yellow-400">Take Quiz</button>
                                    </div>
                                </div>
                            </div>
                        ))}
                    </main>
                    
                    {/* Simplified Modals */}
                    {viewingLesson && <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"><div className="bg-white rounded-xl shadow-2xl w-full max-w-2xl h-[80vh] flex flex-col"><div className="p-4 border-b flex justify-between font-bold"><span>{viewingLesson.title}</span><button onClick={()=>setViewingLesson(null)}><X /></button></div><div className="p-8 overflow-auto flex-1 bg-gray-100"><div className="bg-white p-8 shadow min-h-full">Mock PDF Content...</div></div></div></div>}
                    
                    {viewingVideo && <div className="fixed inset-0 bg-black/90 flex items-center justify-center z-50 p-4"><div className="w-full max-w-4xl"><div className="flex justify-end mb-2"><button onClick={()=>setViewingVideo(null)} className="text-white"><X /></button></div><div className="aspect-video bg-black flex items-center justify-center text-white">Simulated Video Player: {viewingVideo.title}</div></div></div>}
                    
                    {uploading && <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"><div className="bg-white rounded-xl p-6 w-full max-w-md"><h3 className="font-bold text-lg mb-4">Upload Submission</h3><p className="mb-4 text-sm text-gray-600">For: {uploading.title}</p><div className="border-2 border-dashed p-8 text-center rounded mb-4 text-sm text-gray-500">Drop file here</div><div className="flex justify-end gap-2"><button onClick={()=>setUploading(null)} className="px-4 py-2 rounded text-gray-600 hover:bg-gray-100">Cancel</button><button onClick={()=>{alert('Uploaded!'); setUploading(null)}} className="px-4 py-2 rounded bg-blue-600 text-white hover:bg-blue-700">Submit</button></div></div></div>}
                </div>
            );
        };

        const StudentQuizView = ({ courseId, onBack }) => {
            const course = COURSES_DATA[courseId] || COURSES_DATA.physics2;
            const [qIdx, setQIdx] = useState(0);
            const [answers, setAnswers] = useState({});
            const [done, setDone] = useState(false);
            
            const questions = course.quizQuestions;

            if (done) return (
                <div className="flex-1 flex flex-col items-center justify-center h-screen bg-gray-50">
                    <div className="bg-white p-10 rounded-xl shadow text-center">
                        <h2 className="text-2xl font-bold mb-4">Quiz Complete!</h2>
                        <p className="text-4xl font-bold text-[#660000] mb-6">80%</p>
                        <button onClick={onBack} className="px-6 py-2 bg-gray-200 rounded hover:bg-gray-300 font-bold">Back to Course</button>
                    </div>
                </div>
            );

            return (
                <div className="flex-1 flex flex-col bg-gray-50 min-h-screen">
                    <header className="bg-[#660000] text-white p-4 flex justify-between shadow"><span className="font-bold">Quiz: {course.title}</span><button onClick={onBack} className="text-sm opacity-80">Exit</button></header>
                    <main className="flex-1 p-8 max-w-2xl mx-auto w-full">
                        <div className="bg-white p-8 rounded-xl shadow border">
                            <h3 className="text-lg font-bold mb-4">Question {qIdx + 1} of {questions.length}</h3>
                            <p className="mb-6 text-lg">{questions[qIdx].text}</p>
                            <div className="space-y-3">
                                {questions[qIdx].options.map((opt, i) => (
                                    <div key={i} onClick={() => setAnswers({...answers, [qIdx]: i})} className={`p-4 rounded border cursor-pointer ${answers[qIdx] === i ? 'bg-red-50 border-[#660000]' : 'hover:bg-gray-50'}`}>
                                        {opt}
                                    </div>
                                ))}
                            </div>
                            <div className="mt-8 flex justify-between">
                                <button disabled={qIdx === 0} onClick={() => setQIdx(qIdx - 1)} className="text-gray-500 disabled:opacity-50">Previous</button>
                                {qIdx < questions.length - 1 ? 
                                    <button onClick={() => setQIdx(qIdx + 1)} className="font-bold text-[#660000]">Next</button> :
                                    <button onClick={() => setDone(true)} className="bg-green-600 text-white px-6 py-2 rounded font-bold">Submit</button>
                                }
                            </div>
                        </div>
                    </main>
                </div>
            );
        };

        const App = () => {
            const [view, setView] = useState('login');
            const [activeCourse, setActiveCourse] = useState(null);

            const handleLogin = (role) => {
                if (role === 'student') setView('dashboard');
                else alert("Teacher/Admin dashboards are placeholders in this HTML demo.");
            };

            const handleProfileClick = () => setView('profile');

            return (
                <React.Fragment>
                    {view === 'login' && <LoginView onLogin={handleLogin} />}
                    {view === 'profile' && <PersonalAccountView onBack={() => setView('dashboard')} onLogout={() => setView('login')} />}
                    {view === 'dashboard' && <StudentDashboard onViewCourse={(id) => { setActiveCourse(id); setView('course'); }} onTakeQuiz={(id) => { setActiveCourse(id); setView('quiz'); }} onProfileClick={handleProfileClick} />}
                    {view === 'course' && <CourseView courseId={activeCourse} onTakeQuiz={(id) => { setActiveCourse(id); setView('quiz'); }} onProfileClick={handleProfileClick} />}
                    {view === 'quiz' && <StudentQuizView courseId={activeCourse} onBack={() => setView('course')} />}
                    {view !== 'login' && <GeminiChatWidget />}
                </React.Fragment>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>